# Agent Wallboard Backend ЁЯЪж

р╣Бр╕Ър╣Зр╕Бр╣Ар╕нр╕Щр╕Фр╣Мр╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ъ Agent Wallboard р╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕З REST API р╣Бр╕ер╕░ WebSocket р╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣Мр╣Бр╕Ър╕Ър╣Ар╕гр╕╡р╕вр╕ер╣Др╕Чр╕бр╣М р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н SQLite р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣Мр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ р╣Бр╕ер╕░ MongoDB р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕ер╣Ир╕▓р╕кр╕╕р╕Ф р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Чр╕▒р╣Йр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕╡р╕б Supervisor р╣Бр╕ер╕░ Agent р╕Юр╕гр╣Йр╕нр╕бр╕гр╕░р╕Ър╕Ър╕Ир╕│р╕Бр╕▒р╕Фр╕нр╕▒р╕Хр╕гр╕▓р╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ (rate limit) р╣Гр╕Щр╕Хр╕▒р╕з

## р╕Др╕╕р╕Ур╕кр╕бр╕Ър╕▒р╕Хр╕┤р╣Ар╕Фр╣Ир╕Щ тЬи
- ЁЯФР р╕гр╕▒р╕Ър╕гр╕нр╕Зр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕вр╕Фр╣Йр╕зр╕в JWT Authentication + middleware р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М
- ЁЯФБ WebSocket (Socket.IO) р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╕бр╣Ир╣Бр╕Ър╕Ър╕Чр╕▒р╕Щр╕Чр╕╡ р╕Юр╕гр╣Йр╕нр╕б heartbeat р╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ър╕Бр╕▓р╕гр╕лр╕ер╕╕р╕Фр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н
- ЁЯзо р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Кр╕┤р╕Зр╕кр╕Цр╕┤р╕Хр╕┤р╕Ир╕▓р╕Б SQLite (р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣М/р╕Чр╕╡р╕б) + MongoDB (р╕кр╕Цр╕▓р╕Щр╕░, р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б) р╣Гр╕Щр╕гр╕░р╕Ър╕Ър╣Ар╕Фр╕╡р╕вр╕з
- ЁЯЫбя╕П Rate Limiting р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕╕р╕Б API р╣Бр╕ер╕░р╕ер╕┤р╕бр╕┤р╕Хр╕Юр╕┤р╣Ар╕ир╕йр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕З Auth р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щ brute-force
- ЁЯй║ Endpoint `/health` р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╣Бр╕ер╕░р╕лр╕Щр╣Ир╕зр╕вр╕Др╕зр╕▓р╕бр╕Ир╕│р╣Бр╕Ър╕Ър╣Ар╕гр╕╡р╕вр╕ер╣Др╕Чр╕бр╣М
- ЁЯз░ р╕Хр╕▒р╕зр╕Кр╣Ир╕зр╕вр╣Бр╕Ыр╕ер╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е (`utils/transformers.js`) р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕╖р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Чр╕╡р╣И UI р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

## р╕кр╕Цр╕▓р╕Ыр╕▒р╕Хр╕вр╕Бр╕гр╕гр╕бр╣Вр╕Фр╕вр╕кр╕гр╕╕р╕Ы ЁЯзй
```
Client (Agent / Supervisor UI)
    тФВ
    тФЬтФА REST API (Express) тЖТ Authentication, Agents, Messages
    тФВ
    тФЬтФА Socket.IO Gateway тЖФ Broadcast р╕кр╕Цр╕▓р╕Щр╕░/р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕гр╕╡р╕вр╕ер╣Др╕Чр╕бр╣М
    тФВ
    тФЬтФА SQLite (agents, teams)   тАУ р╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕Зр╣Бр╕Ър╕Ър╕нр╣Ир╕▓р╕Щр╕Ър╣Ир╕нр╕в
    тФФтФА MongoDB (statuses, messages) тАУ р╣Ар╕Бр╣Зр╕Ър╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М/р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕ер╣Ир╕▓р╕кр╕╕р╕Ф
```

## р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕лр╕ер╕▒р╕Б ЁЯУБ
```
backend-server/
тФЬтФА config/            # р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░ helper path
тФЬтФА middleware/        # JWT auth р╣Бр╕ер╕░ global error handler
тФЬтФА models/            # Agent (SQLite), Status/Message (MongoDB)
тФЬтФА routes/            # auth, agents, messages REST endpoints
тФЬтФА socket/            # socketHandler.js р╕Фр╕╣р╣Бр╕е WebSocket events
тФЬтФА utils/             # р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Бр╕Ыр╕ер╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Й UI
тФЬтФА server.js          # р╕Ир╕╕р╕Фр╣Ар╕гр╕┤р╣Ир╕бр╕Вр╕нр╕Зр╣Бр╕нр╕Ы + р╕Ър╕╣р╕Х WebSocket
тФФтФА package.json       # р╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╣Бр╕ер╕░ dependencies
```

## р╕Вр╣Йр╕нр╕Бр╕│р╕лр╕Щр╕Фр╕Бр╣Ир╕нр╕Щр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ ЁЯз▒
- Node.js тЙе 18 р╣Бр╕ер╕░ npm
- SQLite3 CLI р╕лр╕гр╕╖р╕нр╣Др╕Яр╕ер╣Мр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е `wallboard.db` р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕ер╣Ир╕зр╕Зр╕лр╕Щр╣Йр╕▓
- MongoDB (р╣Вр╕ер╕Др╕▒р╕ер╕лр╕гр╕╖р╕нр╕гр╕╡р╣Вр╕бр╕Х) р╕Юр╕гр╣Йр╕нр╕бр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н
- р╣Др╕Яр╕ер╣М `.env` р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓ CORS, JWT р╣Бр╕ер╕░р╕Юр╕▓р╕Шр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е

## р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕ер╕░р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ ЁЯЫая╕П
1. р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З dependencies  
   ```bash
   npm install
   ```
2. р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Др╕Яр╕ер╣М SQLite  
   - р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Др╕▓р╕Фр╕лр╕зр╕▒р╕Зр╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕З `./database/sqlite/wallboard.db` (р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Бр╕Бр╣Йр╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╣Бр╕Ыр╕г `SQLITE_DB_PATH`)  
   - р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╣Др╕Яр╕ер╣М р╣Гр╕лр╣Йр╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Фр╣Ар╕гр╕Бр╕Чр╕нр╕гр╕╡р╣Бр╕ер╕░р╕кр╕Др╕╡р╕бр╕▓р╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З р╣Ар╕Кр╣Ир╕Щ
     ```bash
     mkdir -p database/sqlite
     sqlite3 database/sqlite/wallboard.db < schema.sql
     ```
3. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ MongoDB р╣Гр╕лр╣Йр╕Юр╕гр╣Йр╕нр╕бр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н р╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕Зр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е `wallboard` р╕лр╕гр╕╖р╕нр╕Кр╕╖р╣Ир╕нр╕нр╕╖р╣Ир╕Щр╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
4. р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М `.env` (р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕З) р╣Бр╕ер╣Йр╕зр╕кр╕Хр╕▓р╕гр╣Мр╕Хр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
   ```bash
   npm run dev   # р╣Гр╕Кр╣Й nodemon
   # р╕лр╕гр╕╖р╕н
   npm start     # р╕гр╕▒р╕Щр╕Ыр╕Бр╕Хр╕┤
   ```

### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕Яр╕ер╣М `.env` ЁЯМ▒
```ini
PORT=3001
JWT_SECRET=super-secret-change-me
CORS_ORIGIN=http://localhost:5173,http://localhost:3000
SQLITE_DB_PATH=./database/sqlite/wallboard.db
MONGODB_URI=mongodb://127.0.0.1:27017/wallboard
```

## р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ ЁЯЪА
1. **р╕кр╕Хр╕▓р╕гр╣Мр╕Хр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М**  
   ```bash
   npm run dev   # р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Юр╕▒р╕Тр╕Щр╕▓
   # р╕лр╕гр╕╖р╕н
   npm start     # р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕ар╕▓р╕Юр╣Бр╕зр╕Фр╕ер╣Йр╕нр╕б production-like
   ```
   р╕лр╕ер╕▒р╕Зр╕Ър╕╣р╕Хр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Ир╕░р╣Ар╕лр╣Зр╕Щ log р╕кр╕гр╕╕р╕Ы REST routes р╣Бр╕ер╕░ WebSocket events р╣Гр╕Щ terminal

2. **р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╕Вр╕н JWT** (р╣Гр╕Кр╣Й Agent р╕лр╕гр╕╖р╕н Supervisor code р╕Чр╕╡р╣Ир╕бр╕╡р╣Гр╕Щ SQLite)  
   ```bash
   curl -X POST http://localhost:3001/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"agentCode":"AGENT001"}'
   ```
   - р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Ир╕░р╕бр╕╡ `data.token` р╕Щр╕│р╣Др╕Ыр╣Гр╕Кр╣Йр╣Ар╕гр╕╡р╕вр╕Б API р╕нр╕╖р╣Ир╕Щр╣Др╕Фр╣Й
   - р╕лр╕▓р╕Бр╣Ар╕Ыр╣Зр╕Щ Supervisor р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╣Ир╕З `teamData` (р╕лр╕ер╕▒р╕З transformer) р╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ

3. **р╣Ар╕гр╕╡р╕вр╕Б REST API р╕Фр╣Йр╕зр╕в JWT**  
   ```bash
   TOKEN=<token р╕Ир╕▓р╕Бр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╣Ир╕нр╕Щ>
   curl -X GET http://localhost:3001/api/agents/team/1 \
     -H "Authorization: Bearer $TOKEN"
   ```
   - р╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕З `/api/agents/team/:teamId` р╕Ир╕░р╕Др╕╖р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕Цр╕▓р╕Щр╕░р╕ер╣Ир╕▓р╕кр╕╕р╕Фр╕Ир╕▓р╕Б MongoDB р╕гр╕зр╕бр╕Бр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ SQLite
   - р╣Гр╕Кр╣Й `PUT /api/messages/:messageId/read` р╕лр╕гр╕╖р╕н `PUT /api/agents/:agentCode/status` р╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е

4. **р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ WebSocket (Socket.IO)**  
   р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М Node.js (р╕Хр╣Йр╕нр╕Зр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З `socket.io-client`)
   ```bash
   npm install socket.io-client
   ```
   ```js
   // client.js
   const { io } = require('socket.io-client');
   const socket = io('http://localhost:3001', { transports: ['websocket'] });

   socket.on('connect', () => {
     socket.emit('agent_connect', { agentCode: 'AGENT001' });
   });

   socket.on('connection_success', payload => console.log('connected', payload));
   socket.on('agent_status_update', payload => console.log('status update', payload));
   socket.on('new_message', payload => console.log('message', payload));

   // р╕кр╣Ир╕Зр╕кр╕Цр╕▓р╕Щр╕░р╣Гр╕лр╕бр╣И
   setTimeout(() => socket.emit('update_status', { agentCode: 'AGENT001', status: 'Busy' }), 2000);
   ```
   - Supervisor р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ event р╣Ар╕Ыр╣Зр╕Щ `supervisor_connect` р╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е agent р╕нр╕нр╕Щр╣Др╕ер╕Щр╣Мр╕Чр╕▒р╕Щр╕Чр╕╡
   - р╣Ар╕бр╕╖р╣Ир╕нр╕Ыр╕┤р╕Фр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╕лр╕гр╕╖р╕нр╕лр╕ер╕╕р╕Фр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╕Ир╕░ broadcast `agent_disconnected` р╣Гр╕лр╣Йр╕Чр╕╕р╕Б Supervisor

5. **р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕З**  
   - р╣Гр╕Кр╣Йр╣Ар╕Чр╕бр╣Ар╕Юр╕ер╕Х тАЬЁЯзк р╣Ар╕Чр╕бр╣Ар╕Юр╕ер╕Хр╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕ЗтАЭ р╕Чр╕╡р╣Ир╕Чр╣Йр╕▓р╕в README р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕зр╕Ър╕гр╕зр╕бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
   - р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Бр╕Щр╕Ър╕лр╕бр╕▓р╕вр╣Ар╕ер╕В commit, р╣Ар╕зр╕нр╕гр╣Мр╕Кр╕▒р╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Ьр╕ер╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕Зр╕ар╕▓р╕вр╕лр╕ер╕▒р╕З

## р╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М npm ЁЯФз
- `npm start` р╕гр╕▒р╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╣Бр╕Ър╕Ър╕Ыр╕Бр╕Хр╕┤р╕Фр╣Йр╕зр╕в Node.js
- `npm run dev` р╕гр╕▒р╕Щр╕Ьр╣Ир╕▓р╕Щ nodemon р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕╡р╣Вр╕лр╕ер╕Фр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ

## REST API р╕лр╕ер╕▒р╕Б ЁЯМР
| Method | Path                            | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в |
|--------|---------------------------------|-----------|
| POST   | `/api/auth/login`               | р╕кр╕гр╣Йр╕▓р╕З JWT token р╕кр╕│р╕лр╕гр╕▒р╕Ъ Agent/Supervisor р╣Бр╕ер╕░р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╕бр╕Чр╕╡р╣Ир╕Фр╕╣р╣Бр╕е |
| POST   | `/api/auth/logout`              | р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ |
| GET    | `/api/agents/team/:teamId`      | р╕Фр╕╢р╕Зр╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣Мр╣Гр╕Щр╕Чр╕╡р╕бр╕Юр╕гр╣Йр╕нр╕бр╕кр╕Цр╕▓р╕Щр╕░р╕ер╣Ир╕▓р╕кр╕╕р╕Ф (р╕Хр╣Йр╕нр╕Зр╕бр╕╡ JWT) |
| PUT    | `/api/agents/:agentCode/status` | р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣Мр╣Бр╕ер╕░р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З MongoDB |
| GET    | `/api/agents/:agentCode/history`| р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░ (query `limit` р╣Др╕Фр╣Й) |
| POST   | `/api/messages/send`            | р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ър╕Ъ direct р╕лр╕гр╕╖р╕н broadcast (р╕гр╕нр╕Зр╕гр╕▒р╕Ъ priority) |
| GET    | `/api/messages/agent/:agentCode`| р╕Фр╕╢р╕Зр╕Бр╕ер╣Ир╕нр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б (р╕гр╕нр╕Зр╕гр╕▒р╕Ъ `limit`, `unreadOnly`) |
| PUT    | `/api/messages/:messageId/read` | р╕Чр╕│р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕зр╣Ир╕▓р╕нр╣Ир╕▓р╕Щр╣Бр╕ер╣Йр╕з |
| GET    | `/health`                       | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕ер╕░ uptime р╕Вр╕нр╕Зр╕Ър╕гр╕┤р╕Бр╕▓р╕г |

> р╕Чр╕╕р╕Бр╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕Зр╕ар╕▓р╕вр╣Гр╕Хр╣Й `/api/*` р╕вр╕Бр╣Ар╕зр╣Йр╕Щ `/api/auth/login` р╣Бр╕ер╕░ `/api/auth/logout` р╕Хр╣Йр╕нр╕Зр╕кр╣Ир╕З Header `Authorization: Bearer <token>`

## WebSocket Events тЪб
**Client тЖТ Server**
- `agent_connect` `{ agentCode }`
- `supervisor_connect` `{ supervisorCode }`
- `update_status` `{ agentCode, status }`
- `send_message` `{ fromCode, toCode?, toTeamId?, content, type }`

**Server тЖТ Client**
- `connection_success` тАУ р╕гр╕░р╕Ър╕╕р╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Бр╕ер╕░р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б (р╣Ар╕Кр╣Ир╕Щ online agents)
- `connection_error` тАУ р╣Ар╕бр╕╖р╣Ир╕нр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Др╕бр╣Ир╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
- `agent_connected` / `agent_disconnected` тАУ broadcast р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╕нр╕нр╕Щр╣Др╕ер╕Щр╣М
- `agent_status_update` тАУ р╕кр╣Ир╕Зр╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Бр╕▓р╕гр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╕Ьр╣Ир╕▓р╕Щ Socket р╕лр╕гр╕╖р╕н REST
- `new_message` тАУ р╕кр╣Ир╕Зр╕Хр╣Ир╕нр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╕бр╣И (direct/broadcast)
- `status_updated`, `status_error`, `message_sent`, `message_error` тАУ р╣Бр╕Ир╣Йр╕Зр╕Ьр╕ер╕Др╕│р╕кр╕▒р╣Ир╕З

> р╕гр╕░р╕Ър╕Ър╕бр╕╡ heartbeat р╕Чр╕╕р╕Б 30 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ client р╕Чр╕╡р╣Ир╕лр╕ер╕╕р╕Фр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Бр╕ер╕░р╕Ыр╕гр╕░р╕Бр╕▓р╕и `agent_disconnected` р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤

## р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е ЁЯЧДя╕П
- **SQLite (`models/Agent.js`)**: р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕нр╣Ар╕Ир╕Щр╕Хр╣Мр╣Бр╕ер╕░р╕Чр╕╡р╕бр╕Ьр╣Ир╕▓р╕Щр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `findByCode`, `findByTeam`, `findAll`
- **MongoDB (`models/Status.js`, `models/Message.js`)**: р╣Ар╕Бр╣Зр╕Ър╕кр╕Цр╕▓р╕Щр╕░ (р╕Юр╕гр╣Йр╕нр╕б index р╕Хр╕▓р╕б agent/team) р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Юр╕гр╣Йр╕нр╕бр╕кр╕Цр╕▓р╕Щр╕░ `isRead`
- р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `initSQLite` р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Фр╣Ар╕гр╕Бр╕Чр╕нр╕гр╕╡р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ permission; р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕кр╕Др╕╡р╕бр╕▓р╣Гр╕лр╣Йр╕гр╕▒р╕Щр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╕кр╕гр╣Йр╕▓р╕Зр╕Бр╣Ир╕нр╕Щр╕кр╕Хр╕▓р╕гр╣Мр╕Х
- `connectMongoDB` р╕бр╕╡ retry р╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕Др╕гр╕▒р╣Йр╕Зр╕Юр╕гр╣Йр╕нр╕б exponential backoff

## р╕Ир╕╕р╕Фр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕кр╕▒р╕Зр╣Ар╕Бр╕Хр╕Бр╕▓р╕гр╕Ур╣М ЁЯУб
- `console.log` р╣Гр╕Щ `server.js` р╣Бр╕кр╕Фр╕Зр╣Ар╕кр╣Йр╕Щр╕Чр╕▓р╕З REST & Event р╕кр╕│р╕Др╕▒р╕Нр╕лр╕ер╕▒р╕Зр╕кр╕Хр╕▓р╕гр╣Мр╕Х
- Endpoint `GET /health` р╕гр╕▓р╕вр╕Зр╕▓р╕Щ `uptime`, `memory` р╣Бр╕ер╕░ timestamp
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Юр╕┤р╣Ир╕б layer monitoring р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕бр╣Др╕Фр╣Йр╕Чр╕╡р╣И middleware `middleware/errorHandler.js`

## ЁЯзк р╣Ар╕Чр╕бр╣Ар╕Юр╕ер╕Хр╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕З (р╕Юр╕гр╣Йр╕нр╕бр╕нр╕┤р╣Вр╕бр╕Ир╕┤)
р╣Гр╕Кр╣Йр╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╣Ар╕Юр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕Чр╕Фр╕кр╕нр╕Ъ/POC р╣Вр╕Фр╕вр╕вр╕╢р╕Фр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕кр╕Ыр╕гр╕┤р╕Щр╕Хр╣М



## р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╣Бр╕Щр╕░р╕Щр╕│ ЁЯзк
- р╕Чр╕Фр╕кр╕нр╕Ъ REST API р╕Фр╣Йр╕зр╕в Postman р╕лр╕гр╕╖р╕н Thunder Client р╕Юр╕гр╣Йр╕нр╕б token р╕Ир╕гр╕┤р╕З
- р╣Гр╕Кр╣Й `socket.io-client` р╕лр╕гр╕╖р╕нр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ър╕Ир╕│р╕ер╕нр╕Зр╕Ир╕▒р╕Ъ Event `agent_status_update`
- р╣Ар╕Юр╕┤р╣Ир╕б unit tests р╕кр╕│р╕лр╕гр╕▒р╕Ъ utility (р╣Ар╕Кр╣Ир╕Щ `transformAgents`) р╕лр╕▓р╕Бр╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Вр╕╡р╕вр╕Щ test suite
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ rate limit р╕Фр╣Йр╕зр╕вр╕Бр╕▓р╕гр╕вр╕┤р╕Зр╕Др╕│р╕Вр╕нр╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Бр╣Гр╕Щ 15 р╕Щр╕▓р╕Чр╕╡ (р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╣Ар╕Кр╣Ир╕Щ k6, autocannon)

## р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╕Бр╕▓р╕гр╕Фр╕╡р╕Юр╕ер╕нр╕в ЁЯЪА
- р╣Гр╕Кр╣Й `pm2` р╕лр╕гр╕╖р╕н `forever` р╕кр╕│р╕лр╕гр╕▒р╕Ъ production process manager
- р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓ `CORS_ORIGIN` р╣Гр╕лр╣Йр╕Хр╕гр╕Зр╕Бр╕▒р╕Ъ origin р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Чр╕╡р╣И UI р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З (р╕Др╕▒р╣Ир╕Щр╕Фр╣Йр╕зр╕в comma)
- р╕кр╕│р╕гр╕нр╕Зр╣Др╕Яр╕ер╣М SQLite р╣Бр╕ер╕░р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ replica set р╣Гр╕лр╣Й MongoDB р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕кр╕╣р╕З

р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з! р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Чр╕╡р╣Ир╣Др╕Яр╕ер╣М `server.js` р╕лр╕гр╕╖р╕нр╣Ар╕Юр╕┤р╣Ир╕бр╣Вр╕бр╕Фр╕╣р╕ер╣Гр╕Щ `routes/` р╣Бр╕ер╕░ `socket/` тнР
